ASMB,L,C
 HED RTE BASIC 'CHAR' INTERFACE                    A-91200-16002-2
* 
*     NAME:   RTE BASIC 'CHAR' INTERFACE
*     SOURCE: 91200-18002 (FILE 1)
*     BINARY: 91200-16002 (MODULE 1)
*     PGMR:   L.W.S. ADDED TO LIBRARY BY DENTON ANDERSON. 
*                REV.B(1603) IS FOR COLOR OPERATION.
*                REV.C(1648) IS FOR POWER FAIL - AUTO RESTART.
* 
* 
      NAM CHARS,7 91200-16002 REV 1648 -- 761124
      ENT CHARS 
      EXT .ENTR,CH#R
      SPC 2 
*   THIS ROUTINE SERVES AS AN INTERFACE BETWEEN THE TV LIBRARY
*   ROUTINE 'CHAR' AND A BASIC CALLING PROGRAM.  IT ACCEPTS THE 
*   ADDRESS OF A STRING VARIABLE (AS WELL AS A STRING IN QUOTES), 
*   PUTS THE STRING LENGTH TEMPORAIRLY IN WORD 1 OF THE STRING
*   ARRAY, AND THEN CALLS THE CHAR LIBRARY ROUTINE TO DISPLAY 
*   THE CHARACTER STRING.  ALL OTHER PARAMETERS ARE PASSED DIRECTLY 
*   TO CHAR AS RECEIVED.  THE BASIC USER MUST CALL IT AS FOLLOWS: 
* 
*     10 CALL CHARS(X,Y,A$,S,D,N,M,P) 
* 
*        X,Y --> X,Y COORDINATES OF LOWER-LEFT HAND POINT WHERE 
*                CHARACTER STRING IS TO BE DISPLAYED. 
* 
*        A$  --> STRING VARIABLE CONTAINING STRING TO BE DISPLAYED. 
* 
*        S   --> CHARACTER SIZE.
* 
*        D   --> DIRECTION. 
* 
*        N   --> ARRAY STRUCTURE (FORCED TO 0). 
* 
*        M   --> DISPLAY MODE.
* 
*        P   --> POWER FAIL INDICATOR.
      SKP 
*   TYPICAL BASIC PROGRAM 
*   --------------------- 
* 
*     10 DIM A$(72) 
*     20 PRINT "ENTER TV LU #, DISPLAY SENSE: ";
*     30 INPUT L,S
*     40 CALL VIDLU(L,S)
*     50 CALL ERASE 
*     60 PRINT "ENTER ANY CHARACTER STRING OR /E" 
*     70 INPUT A$ 
*     80 IF A$(1,2)="/E" THEN 160 
*     90 PRINT "ENTER X,Y,SIZE,DIREC,MODE: "; 
*     100 INPUT X,Y,S,D,M 
*     110 CALL CHARS(X,Y,A$,S,D,0,M,P)
*     120 IF P#0 THEN 140 
*     130 GO TO 50
*     140 PRINT"POWER FAIL, START OVER" 
*     150 GO TO 20
*     160 PRINT"DONE" 
*     170 END 
* 
* 
*   BRANCH & MNEMONIC TABLE CONSIDERATIONS
*   --------------------------------------
* 
*   THE FOLLOWING TYPE OF ENTRY MUST BE MADE: 
* 
*  FOR RTE-B: 
*     CHARS(I,I,R,I,I,I,I,V)
* 
*  FOR REAL TIME BASIC: 
*     CHARS(I,I,RA,I,I,I,I,IV)
* 
*   THE ENTRY POINT MUST BE 'CHARS' WITH EIGHT PARAMETERS EXACTLY 
*   AS SHOWN.  PARAMETER NUMBER 3 MUST BE SPECIFIED AS REAL SO THAT 
*   THE STRING ARRAY (A$) CAN BE RETRIEVED DURING RUN TIME.  PARAMETER
*   NUMBER 6 CAN BE SPECIFIED AS ANYTHING SINCE IT IS ALWAYS PASSED 
*   AS ZERO TO THE TV LIBRARY ROUTINE.
      SKP 
X     NOP           STARTING X & Y COORDINATES OF THE 
Y     NOP            THE LOWER-LEFT CORNER. 
BUFR  NOP           ADRS OF CHAR. STRING OR LITERAL.
SIZE  DEF .0        CHARACTER SIZE. 
DIREC DEF .0        STRING DIRECTION. 
NUMBR NOP           ARRAY STRUCTURE.
MODE  DEF .0        DISPLAY MODE. 
PFL   NOP           POWER FAIL INDICATOR. 
      SPC 1 
CHARS NOP   << ENTRY POINT >> 
      JSB .ENTR    GET PARAMETER ADDRESSES. 
      DEF X 
      SPC 1 
      LDA BUFR,I   SAVE STATEMENT COMPILE CODE. 
      STA TEMP     SAVE FOR LATER RESTORE.
      AND .377     ISOLATE STRING LENGTH. 
      STA BUFR,I   TEMPORARILY PUT BACK IN STRING.
      LDA PFL       TRANSFER POWER FAIL INDICATOR 
      STA PFAIL       ADDRESS FOR NEXT CALL.
      SPC 1 
*... CALL CHAR LIBRARY ROUTINE ...
      SPC 1 
      JSB CH#R     CALL 
      DEF *+9       THE 
      DEF X,I        ACTUAL 
      DEF Y,I         TV
      DEF BUFR,I       LIBRARY
      DEF SIZE,I        ROUTINE.
      DEF DIREC,I 
      DEF .0
      DEF MODE,I
PFAIL NOP 
      SPC 1 
      LDA TEMP     RESTORE ACTUAL FIRST WORD IN 
      STA BUFR,I    BASIC SYMBOL TABLE. 
      LDA DEF0      RE-ESTABLISH DEFAULTS 
      STA SIZE        / 
      STA DIREC       / 
      STA MODE        / 
      CLA             / 
      STA PFL         / 
      JMP CHARS,I     RETURN TO BASIC.
      SPC 1 
TEMP  NOP          HOLDS ORIGINAL FIRST WORD OF S.T.
.0    OCT 0        BUFFER STRUCTURE PARAMETER.
.377  OCT 377      STRING COUNT MASK VALUE. 
DEF0  DEF .0
      SPC 1 
      END
