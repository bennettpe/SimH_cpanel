ASMB,L,C
      HED VIDEO SUBROUTINES POINT,VIDLU,ERASE      A-91200-16002-2
* 
*     NAME:   EXEC INTERFACE OF VIDEO DISPLAY LIBRARY 
*     SOURCE: 91200-18002 (FILE 6)
*     BINARY: 91200-16002 (MODULE 6)
*     PGMR:   R.M.C. REV.C(1648) MADE BY DENTON ANDERSON
*               REV.B(1603) IS FOR COLOR OPERATION. 
*               REV.C(1648) IS FOR POWER FAIL - AUTO RESTART. 
* 
* 
      NAM POINT,7 91200-16002 REV 1648 -- 761124
      SPC 1 
      ENT POINT,VIDLU,ERASE 
      EXT .ENTR,EXEC,RSFLG
      SPC 1 
BUFFR NOP 
NUM   DEF B1
MODE  DEF ZERO
PFAIL NOP           POWER FIAL INDICATOR. 
      SPC 1 
POINT NOP           ENTRY POINT 
      JSB .ENTR 
       DEF BUFFR
      LDA NUM,I 
      SZA,RSS       IF 0,RETURN WITH NO 
      JMP PRTN       ACTION.
      STA NUM 
      LDA CPRAM 
      AND B200      KEEP BIT 7 OF CPRAM FOR CONTROL 
      STA B          REQUEST TO DRIVER
      LDA MODE,I    GET COLOR CODE
      AND B7
      CLE,ERA       POSITION
      RAL,RAL         COLOR BITS
      ELA,ALF           FOR CONTROL 
      RAL,RAL             CALL
      IOR B         FORM MODE BITS FOR CONTROL WORD 
      IOR LU        COMPLETE CONTROL WORD 
      STA CPRAM       AND SAVE
      SPC 1 
      LDA PFAIL     IS POWER FAIL 
      SZA,RSS         TO BE CHECKED?
      JMP SMODE         NO - GO ON
      SPC 1 
      JSB EXEC      STATUS CALL FOR POWER FAIL
      DEF SRTN
      DEF D13 
      DEF LU
      DEF PSTAT 
      SPC 1 
SRTN  LDA PSTAT 
      AND B1
      STA PFAIL,I 
      SKP 
SMODE JSB EXEC      SEND LAST SENSE AND CURRENT 
       DEF P1        MODE TO DRIVER IN
       DEF B3         CONTROL REQUEST.
       DEF CPRAM    SENSE & MODE PARAMETERS & LU. 
      SPC 1 
P1    JSB EXEC      SEND COORDINATES OF EACH
       DEF  PRTN      POINT IN USER'S BUFFER
       DEF B2 
       DEF LU 
       DEF BUFFR,I
       DEF NUM
      SPC 1 
PRTN  LDA DEFB1     RESTORE DEFAULT 
      STA NUM        PARAMETERS FOR NEXT CALL.
      LDA DZERO 
      STA MODE
      CLA 
      STA PFAIL 
      JMP POINT,I 
      SPC 2 
B     EQU 1 
B1    OCT 1 
B2    OCT 2 
B3    OCT 3 
B7    OCT 7 
B77   OCT 77
B200  OCT 200 
B400  OCT 400 
D13   DEC 13
ZERO  OCT 0 
DEFB1 DEF B1
DZERO DEF ZERO
CPRAM NOP 
PSTAT NOP 
      SKP 
LU    NOP 
SENSE DEF ZERO
      SPC 1 
VIDLU NOP           ENTRY POINT 
      JSB .ENTR 
       DEF LU 
      LDA LU,I
      AND B77 
      STA LU
      LDB SENSE,I   IF SENSE PARAMETER IS 0,
      SZB            CLEAR BIT 7 OF CPRAM 
      LDB B200        ELSE SET BIT 7 OF CPRAM.
      IOR B 
      STA CPRAM 
      JSB EXEC      SEND CURRENT SENSE TO DRIVER
       DEF VRTN      TO SET I/O CARD FOR EITHER 
       DEF B3         WHITE-ON-BLACK OR 
       DEF CPRAM       BLACK-ON-WHITE.
VRTN  LDA DZERO 
      STA SENSE 
      JSB RSFLG     SET SAVE RESOURCES TERMINATION
      DEF *+1         FOR MULTI-USER BASIC
      JMP VIDLU,I 
      SPC 4 
ERASE NOP 
      JSB .ENTR 
       DEF ERASE    PROTECT AGAINST PARAMETERS
      LDA LU
      IOR B400
      STA EWRD
      JSB EXEC      SEND CONTROL REQUEST TO 
       DEF ERTN      DRIVER WITH BIT 8 OF CONTROL 
       DEF B3         WORD SET TO EFFECT A BULK 
       DEF EWRD        ERASE TO THE SENSE PREVIOUSLY
ERTN  JMP ERASE,I       SET BY CALL TO VIDLU. 
      SPC 1 
EWRD  NOP 
      SPC 2 
      END
