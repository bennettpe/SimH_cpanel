1 REM FRACTAL LANDSCAPE BY ROBERTO SANCHO APR-2017
10 CALL VIDLU(7,0)
20 LET D0=0
100 REM S=SIZE (POWER OF TWO),Z=ELEVATION GRID (S PLUS 1)
101 REM W0=WATER LEVEL
102 REM O0=ELEVATION REDUCTION
110 LET S=16
111 LET W0=0
112 LET O0=20
120 DIM Z[17,17]
130 REM R1=RANDOM ELEVATION MULTIPLIER R2=MULTIPLIER REDUCTION 
132 LET R1=100
134 LET R2=0.6
136 LET R0=R1+5
140 REM ANGLES FOR ISOMETRIC PROYECTION (0..90)
141 REM G0 HORZ, G1 VERT (0=VIEW FROM SIDE, 90=TOp VIEW)
141 REM G1 VERT (0=VIEW FROM SIDE, 90=TOp VIEW)
150 G0=30
155 G1=70
160 FOR X=1 TO S+1
170 FOR Y=1 TO S+1
180 Z[X,Y]=-999
190 NEXT Y
200 NEXT X
210 REM 
220 REM SET INITIAL RANDOM DISPLACEMENT FOR CORNERS
230 REM 
240 GOSUB 6000
250 LET Z[1,1]=P0
260 GOSUB 6000
270 LET Z[1,S+1]=P0
280 GOSUB 6000
290 LET Z[S+1,1]=P0
300 GOSUB 6000
310 LET Z[S+1,S+1]=P0
320 LET R1=R1*R2
1000 REM 
1010 REM ITERATE
1020 REM 
1030 LET N=S
1100 REM 
1110 REM SQUARE STEP
1120 REM 
1130 FOR X=1 TO S STEP N
1140 FOR Y=1 TO S STEP N
1150 LET X0=X+N/2
1160 LET Y0=Y+N/2
1170 LET A=Z[X,Y] + Z[X+N,Y] + Z[X,Y+N] + Z[X+N,Y+N]
1180 GOSUB 6000
1190 LET A=INT(A/4)+P0
1200 LET Z[X0,Y0]=A
1210 NEXT Y
1220 NEXT X
1300 REM 
1310 REM DIAMOND STEP
1320 REM 
1330 FOR X=1 TO S+1 STEP N
1340 FOR Y=1 TO S+1 STEP N
1350 LET X0=X+N/2
1360 LET Y0=Y
1370 GOSUB 6400
1380 LET X0=X-N/2
1390 LET Y0=Y
1400 GOSUB 6400
1410 LET X0=X
1420 LET Y0=Y+N/2
1430 GOSUB 6400
1440 LET X0=X
1450 LET Y0=Y-N/2
1460 GOSUB 6400
1470 NEXT Y
1480 NEXT X
1600 REM 
1610 REM NOW DRAW,REDUCE STEP AND DO NEXT ITERATION
1620 REM 
1630 GOSUB 7000
1640 LET R1=R1*R2
1650 LET N=N/2
1660 IF N > 1 GOTO 1100
1800 GOTO 130
1810 END
1820 REM
6000 REM RETURN P0=RANDOM ELEVATION GENERATION
6010 LET P0=RND(1)
6020 LET T0=INT(P0*R1)
6022 LET T1=INT(R1/2)
6030 LET P0=T0-T1
6050 RETURN
6060 REM 
6100 REM RETURN A0=AVGE HEIGHT ARROUND X0 Y0 CROSS SHAPE
6105 REM DIST N/2,A1 POINTS
6110 LET A0=0
6111 LET A1=0
6120 LET X1=X0-N/2
6130 LET Y1=Y0
6140 GOSUB 6300
6150 LET X1=X0+N/2
6160 LET Y1=Y0
6170 GOSUB 6300
6180 LET X1=X0
6190 LET Y1=Y0-N/2
6200 GOSUB 6300
6210 LET X1=X0
6220 LET Y1=Y0+N/2
6230 GOSUB 6300
6240 LET A0=INT(A0/A1)
6250 RETURN
6260 REM 
6300 REM ADD A POINT TO AVERAGE IF COORDS IN RANGE
6310 IF (X1<1)OR(X1>S+1)OR(Y1<1)OR(Y1>S+1) RETURN
6320 LET A0=A0+Z[X1,Y1]
6330 LET A1=A1+1
6340 RETURN
6350 REM 
6400 REM SET HEIGHT TO X0,Y0 WITH POINTS ARROUND
6405 IF (X0<1)OR(X0>S+1)OR(Y0<1)OR(Y0>S+1) RETURN
6410 GOSUB 6100
6430 GOSUB 6000
6440 LET A=A0+P0
6450 LET Z[X0,Y0]=A
6460 RETURN
6470 REM 
7000 REM DISPLAY TERRAIN
7005 GOSUB 7200
7010 PRINT
7020 PRINT "ITERATION N=";N;
7021 PRINT "ROT H=";G0;" ROT V=";G1;
7022 PRINT " WATER LEVEL=";W0;" ELEV=";O0
7030 PRINT
7031 IF D0=0 GOTO 7040
7032 REM DEMO MODE
7034 IF D0=1 GOTO 8650
7035 IF W0<70 GOTO 8700
7036 D0=0
7037 PRINT "DEMO END"
7038 PRINT
7039 GOTO 9999
7040 PRINT "0-QUIT"
7050 PRINT "1-ROT LEFT         2-ROT RIGHT"
7060 PRINT "3-ROT UP           4-ROT DOWN"
7065 PRINT "5-RAISE WATER      6-LOWER WATER"
7066 PRINT "7-IMAGE UP         8-IMAGE DOWN"
7070 IF N>2 PRINT "9-NEXT ITERATION  99-DEMO"
7071 IF N=2 PRINT "9-NEW LANDSCAPE   99-DEMO"
7080 PRINT
7090 PRINT "ENTER COMMAND?"
7100 INPUT M0
7110 IF M0=0 GOTO 9999
7120 IF M0=9 RETURN
7125 IF M0=99 GOTO 8600
7130 IF M0=1 LET G0=G0-10
7132 IF M0=2 LET G0=G0+10
7140 IF M0=3 LET G1=G1+10
7142 IF M0=4 LET G1=G1-10
7150 IF G0<0 LET G0=0
7151 IF G0>90 LET G0=90
7152 IF G1<0 LET G1=0
7153 IF G1>90 LET G1=90
7160 IF M0=5 LET W0=W0+20
7161 IF M0=6 LET W0=W0-20
7162 IF W0<0 LET W0=0
7163 IF W0>R0 LET W0=R0
7170 IF M0=7 LET O0=O0-20
7171 IF M0=8 LET O0=O0+20
7172 IF O0<0 LET O0=0
7173 IF O0>200 LET O0=200
7190 GOTO 7000
7200 REM DRAW AS ISOMETRIC
7210 CALL ERASE
7214 CALL CHARS(10,10,"LANDSCAPE (TV)",1,0,0,0)
7215 GOSUB 8500
7230 FOR Y=1 TO S+1
7240 FOR X=1 TO S+1
7250 X9=0
7260 Y9=1
7270 GOSUB 8000
7280 X9=1
7290 Y9=0
7300 GOSUB 8000
7310 REM X9=1        THIS IS A DIAGONAL LINE
7320 REM Y9=1         COMMENTED OUT
7330 REM GOSUB 8000    UNCOMMENT TO RESTORE
7340 NEXT X
7350 NEXT Y
7400 RETURN
8000 REM MAKE A LINE BETWEEN X Y and X+X9 Y+Y9
8010 X0=X
8020 Y0=Y
8030 GOSUB 8200
8040 IF X1<-900 RETURN
8050 X2=X1
8060 Y2=Y1
8065 W2=W1
8070 X0=X
8080 Y0=Y
8090 X0=X0+X9
8100 Y0=Y0+Y9
8110 GOSUB 8200
8120 IF X1=-999 GOTO 8090
8130 IF X1<-900 RETURN
8140 REM X1 Y1 X2 Y2 FOR LINE BLUE IF W1=W2=1
8141 A=3
8142 IF (W1=1)AND(W2=1) LET A=4
8145 IF X1<0 LET X1=0
8146 IF X2<0 LET X2=0
8147 IF Y1<0 LET Y1=0
8148 IF Y2<0 LET Y2=0
8150 IF X1>255 LET X1=255
8151 IF X2>255 LET X2=255
8152 IF Y1>255 LET Y1=255
8153 IF Y2>255 LET Y2=255
8160 CALL PLINE(X1,Y1,X2,Y2,A)
8170 RETURN
8200 REM CONVERT X0 (1..S) Y0 TO X1 (0..255) Y1 ISOMETRIC USING COEFS
8205 X1=-901
8206 W1=0
8210 IF (X0<1)OR(X0>S+1)OR(Y0<1)OR(Y0>S+1) RETURN
8220 Z0=Z[X0,Y0]
8230 X1=-999
8240 IF Z0=-999 RETURN
8250 Z0=Z0+R0
8260 IF Z0<W0 LET W1=1
8261 REM UNDER THE sEA. SET FLAG W1
8270 IF W1=1 LET Z0=W0
8350 F1=(X0-1)/S
8360 F2=(Y0-1)/S
8370 X1=5+INT(K1*(1-F1)+K2*F2)
8380 Y1=5+INT(K3*F1+K4*F2)
8390 Y1=Y1+Z0-O0
8400 RETURN
8500 REM CALC TRANSFORMATION COEFS
8510 C1=COS(G0*3.1416/180)
8520 S1=SIN(G0*3.1416/180)
8525 S2=SIN(G1*3.1416/180)
8527 L0=1-0.3*(1-ABS(G0-45)/45)
8530 K1=220*L0*C1
8540 K2=220*L0*S1
8550 K3=150*S1*S2
8560 K4=150*C1*S2
8570 RETURN
8600 REM START DEMO
8610 D0=1
8620 RETURN
8650 REM CYCLE STEPS
8660 IF N>2 RETURN
8670 D0=2
8680 O0=O0+30
8690 W0=W0+30
8700 REM RAISE WATER
8710 W0=W0+10
8720 GOTO 7000
9999 END


