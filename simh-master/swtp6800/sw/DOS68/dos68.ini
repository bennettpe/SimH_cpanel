set console -n -q log=console.txt 
set debug -n -q debug.txt

set bootrom 2708
attach bootrom swtbug.bin
set cpu hex
set cpu noitrap
set cpu nomtrap
set cpu nodebug
reset
set mp-b2 bd0, bd1, bd2, bd3, bd4, bd5

att dc-40 dos68.DSK
att dc-41 fortran.DSK
set dc-41 rw
att dc-42 edsrc.dsk
set dc-42 rw

; DOS68 5.1 for MF68 Disk - 1980

echo

; disk 35 track x 18 sect x 128 bytes/sector
; Kyroflux conversion raw to dsk:
; dtc -ftrack -i0 -fImage.dsk -v300 -z0 -m1 -g0 -k2 -i3

load SWTBUG.LST
load asm/DOS68_MF68_Loader.LST
load asm/DOS68_MF68_Loader.hex s19
load asm/DOS68.LST

go until "$"
send "JBC00"

go until "READY"
go until "DOS:"

; start symbolic trace
; set cpu debug=symb;inst
; set dc-4 debug=all

send "LIST"
send "\r"
go until "DOS:" 

send "BASICC"
send "\r"
go until "#"

send "FLIST"
send "\r"
go until "#"

send "10 PRINT \"Hola\" \r"
go until "#"
send "20 END \r"
go until "#"
send "LIST \r"
go until "#"
send "RUN \r"
go until "#"

send "DOS"
send "\r"
go until "DOS:" 

send "LIST,1"
send "\r"
go until "DOS:" 

send "VIEW,1:TEST.TXT"
send "\r"
go until "DOS:" 

; set system as disk 0, work disk as disk 1
send "SET,SY=0,WK=1"
send "\r"
go until "DOS:" 

send "DEL TEST.REL"
send "\r"
go until "DOS:" 

send "1:FORTC,TEST.TXT"
send "\r"
go until "DOS:" 

send "1:LNKC"
send "\r"
go until "LNK:" 

send "FREE"
send "\r"
go until "LNK:" 

send "LOAD TEST.REL"
send "\r"
go until "LNK:" 

send "LIB FORTC.LIB"
send "\r"
go until "LNK:" 

send "PRINT"
send "\r"
go until "LNK:" 

send "EXIT"
send "\r"
go until "DOS:" 

send "SET,SY=0,WK=2"
send "\r"
go until "DOS:" 


go

:end
