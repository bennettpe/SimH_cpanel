!
!	REMOVE N FIRST BYTES FROM A BINARY FILE
!
!	Jun 2022 - Roberto Sancho
!	Used to create BOOT.BIN to be set in LSN (Logical Sector Number) zero


	DIM	BIGBLOCK$[128]
	DIM	T$(4), GETFILESIZE$/:F,14,0,:3/
	
	DIM	BYTE$/0/
	DIM	FILE$[100], OUTFILE$[100]
	DIM	COUNT, FILELEN,I, NBYTES

	PRINT	"*** MAKE BINARY PROGRAM ***"

10	INPUT	"Input File= " FILE$
	INPUT	"Output File= " OUTFILE$
	INPUT	"Number of Bytes to Trim= " NBYTES

	IF OUTFILE$="" THEN GOTO 10
	IF NBYTES = 0 THEN GOTO 9999

	CREATE	#2, OUTFILE$
	OPEN	#1, FILE$
	
	SYSCALL #1,GETFILESIZE$,"",T$
	FILELEN=T$[1]*256^3+T$[2]*256^2+T$[3]*256+T$[4]

	FOR I=1 TO NBYTES
	   READ	#1, BYTE$
	NEXT I
	COUNT=FILELEN-NBYTES
	if COUNT < 1 THEN 1000
	
	IF COUNT >= MAXLEN(BIGBLOCK$) THEN
	   FOR I=1 TO INT(COUNT/MAXLEN(BIGBLOCK$))
	      READ #1, BIGBLOCK$
	      WRITE #2, BIGBLOCK$
	      COUNT=COUNT-MAXLEN(BIGBLOCK$)
	   NEXT	I
	FI

	IF COUNT=0 THEN 1000

	FOR I=1 TO COUNT
	   READ #1, BYTE$
	   WRITE #2, BYTE$
	NEXT I

1000	CLOSE	#1
	CLOSE	#2

9999	END

