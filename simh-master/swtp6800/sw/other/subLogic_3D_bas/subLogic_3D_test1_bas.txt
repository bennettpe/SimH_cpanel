8000 DIM X(5),Y(5),Z(5),C(8)
8005 PRINT "SCREEN WIDTH W"
8010 INPUT W
8015  W=W/2-1
8020 PRINT "FIELD OF VIEW V"
8025 INPUT V
8030 PRINT "VIEWER'S LOCATION X,Y,Z"
8035 INPUT X(3),Y(3),Z(3)
8040 PRINT "DIRECTION OF VIEW P,B,H"
8045 INPUT P,B,H
8050 GOSUB 8200
8055 PRINT "START POINT X,Y,Z"
8060 INPUT X(1),Y(1),Z(1)
8065 PRINT "END POINT X,Y,Z"
8070 INPUT X(5),Y(5),Z(5)
8075 GOSUB 8500
8080 IF P2=0 THEN GOTO 8095
8082 PRINT "SCREEN START PT = ",X(2),Y(2)
8083 PRINT "SCREEN END PT = ",X(4),Y(4)
8090 GOTO 8055
8095 PRINT "LINE IS OFF SCREEN"
8099 GOTO 8055

8200  F=P
8203 GOSUB 8300
8204  R1=N
8206  F=P
8209 GOSUB 8310
8212  R2=N
8215  F=B
8218 GOSUB 8300
8221  R3=N
8222  F=B
8224 GOSUB 8310
8227  R4=N
8230  F=H
8233 GOSUB 8300
8236  R5=N
8237  F=H
8239 GOSUB 8310
8245  T1=N*R4+R5*R1*R3
8248  T2=-N*R3+R5*R1*R4
8251  T3=R5*R2*V
8253  T4=R2*R3
8256  T5=R2*R4
8259  T6=-R1*V
8262  T7=-R5*R4+N*R1*R3
8265  T8=R5*R3+N*R1*R4
8269  T9=R2*N*V

8300  F=F-90
8305 IF F<=-180 THEN F=F+360
8310 IF F<0 THEN F=-F
8315  S=F
8320 IF S>=90 THEN F=180-F
8330  N=F*.01745329
8340  A=N*N
8350  M=A*A
8360  N=1-A/2+M/24-A*M/720+M*M/40320
8370 IF S>=90 THEN N=-N
8380 RETURN 

8500 FOR A=1 TO 5 STEP 4
8510  G=X(A)+X(3)
8520  S=Y(A)+Y(3)
8530  K=Z(A)+Z(3)
8540  X(A)=G*T1+S*T4+K*T7 
8550  Y(A)=G*T2+S*T5+K*T8
8560  Z(A)=G*T3+S*T6+K*T9
8570 NEXT A 

8600 FOR A=1 TO 5 STEP 4
8610  C(A)=0
8612  C(A+1)=0
8614  C(A+2)=0
8616  C(A+3)=0
8618 IF X(A) < -Z(A) THEN C(A)=1
8620 IF X(A) > Z(A) THEN C(A+1)=1
8622 IF Y(A) < -Z(A) THEN C(A+2)=1
8624 IF Y(A) > Z(A) THEN C(A+3)=1
8626 NEXT A 
8632 FOR A=1 TO 4 STEP 1
8634 IF C(A)=0 THEN GOTO 8638
8636 IF C(A)=C(A+4) THEN GOTO 8668
8638 NEXT A
8644 FOR A=1 TO 4 STEP 1
8646 IF C(A)=1 THEN GOTO 8676
8648 NEXT A
8654 FOR A=5 TO 8 STEP 1
8656 IF C(A)=1 THEN GOTO 8686
8658 NEXT A
8662  P2=1
8664 GOTO 8800
8668  P2=0
8670 RETURN
8676  A=1
8678  S=5
8680 GOTO 8694
8686  A=5
8688  S=1
8694 IF C(A)=1 THEN GOTO 8728
8696 IF C(A+1)=1 THEN GOTO 8714
8698 IF C(A+2)=1 THEN GOTO 8742
8700 IF C(A+3)=1 THEN GOTO 8756
8706 GOTO 8662
8714  K=(Z(A)-X(A))/(X(S)-X(A)-Z(S)+Z(A))
8716  X(A)=K*(Z(S)-Z(A))+Z(A)
8718  Y(A)=K*(Y(S)-Y(A))+Y(A)
8720  Z(A)=X(A)
8722 GOTO 8600
8728  K=(Z(A)+X(A))/(X(A)-X(S)-Z(S)+Z(A))
8730  X(A)=K*(Z(A)-Z(S))-Z(A)
8732  Y(A)=K*(Y(S)-Y(A))+Y(A)
8734  Z(A)=-X(A)
8736 GOTO 8600
8742  K=(Z(A)+Y(A))/(Y(A)-Y(S)-Z(S)+Z(A))
8744  X(A)=K*(X(S)-X(A))+X(A)
8746  Y(A)=K*(Z(A)-Z(S))-Z(A)
8748  Z(A)=-Y(A)
8750 GOTO 8600
8756  K=(Z(A)-Y(A))/(Y(S)-Y(A)-Z(S)+Z(A))
8758  X(A)=K*(X(S)-X(A))+X(A)
8760  Y(A)=K*(Z(S)-Z(A))+Z(A)
8762  Z(A)=Y(A)
8764 GOTO 8600

8800 IF Z(1)=0 THEN Z(1)=.001
8845 IF Z(5)=0 THEN Z(5)=.001
8855  X(2)=X(1)/Z(1)*W
8860  Y(2)=Y(1)/Z(1)*W
8865  X(4)=X(5)/Z(5)*W
8870  Y(4)=Y(5)/Z(5)*W
8875 RETURN

9999 END
