0201 DIM Q(12),R(12),S(12)

1000  Q(1)=100
1001  R(1)=0
1002  S(1)=1100
1003  Q(2)=500
1004  R(2)=0
1005  S(2)=1100
1006  Q(3)=500
1007  R(3)=0
1008  S(3)=1100
1009  Q(4)=300
1010  R(4)=0
1011  S(4)=1400
1012  Q(5)=300
1013  R(5)=0
1014  S(5)=1400
1015  Q(6)=100
1016  R(6)=0
1017  S(6)=1100
1018  Q(7)=100
1019  R(7)=0
1020  S(7)=1100
1021  Q(8)=300
1022  R(8)=400
1023  S(8)=1200
1024  Q(9)=300
1025  R(9)=0
1026  S(9)=1400
1027  Q(10)=300
1028  R(10)=400
1029  S(10)=1200
1030  Q(11)=300
1031  R(11)=400
1032  S(11)=1200
1033  Q(12)=500
1034  R(12)=0
1035  S(12)=1100

8000 DIM X(5),Y(5),Z(5),C(8)
8005 PRINT "SCREEN WIDTH W"
8010 INPUT W
8015  W=W/2-1
8020 PRINT "FIELD OF VIEW V"
8025 INPUT V
8030 PRINT "VIEWER'S LOCATION X,Y,Z"
8035 INPUT X(3),Y(3),Z(3)
8040 PRINT "DIRECTION OF VIEW P,B,H"
8045 INPUT P,B,H
8050 GOSUB 8200
8055 FOR A1=1 TO 11 STEP 2
8060  X(1)=Q(A1)
8063  Y(1)=R(A1)
8066  Z(1)=S(A1)
8069  X(5)=Q(A1+1)
8072  Y(5)=R(A1+1)
8075  Z(5)=S(A1+1)
8078 GOSUB 8500
8080 IF P2=0 THEN GOTO 8095
8081 PRINT "SCREEN START PT = ",X(2),Y(2)
8082 PRINT "SCREEN END PT = ",X(4),Y(4)
8083 GOSUB 9000
8084 GOTO 8098
8095 PRINT "LINE IS OFF SCREEN"
8098 NEXT A1
8099 GOTO 8030

8200 R1=SIN (P*1.745329E-2)          
8206 R2=COS (P*1.745329E-2)          
8215 R3=SIN (B*1.745329E-2)          
8222 R4=COS (B*1.745329E-2)  
8230 R5=SIN (H*1.745329E-2)          
8237 R6=COS (H*1.745329E-2)  
8245 T1=R4*R6+R5*R1*R3
8248 T2=-R6*R3+R5*R1*R4
8251 T3=R5*R2*V
8253 T4=R2*R3
8256 T5=R2*R4
8259 T6=-R1*V
8262 T7=-R5*R4+R6*R1*R3
8265 T8=R5*R3+R6*R1*R4
8269 T9=R2*R6*V
8272 RETURN

8500 FOR A=1 TO 5 STEP 4
8510  G=X(A)+X(3)
8520  S=Y(A)+Y(3)
8530  K=Z(A)+Z(3)
8540  X(A)=G*T1+S*T4+K*T7 
8550  Y(A)=G*T2+S*T5+K*T8
8560  Z(A)=G*T3+S*T6+K*T9
8570 NEXT A 

8600 FOR A=1 TO 5 STEP 4
8610  C(A)=0
8612  C(A+1)=0
8614  C(A+2)=0
8616  C(A+3)=0
8618 IF X(A) < -Z(A) THEN C(A)=1
8620 IF X(A) > Z(A) THEN C(A+1)=1
8622 IF Y(A) < -Z(A) THEN C(A+2)=1
8624 IF Y(A) > Z(A) THEN C(A+3)=1
8626 NEXT A 
8632 FOR A=1 TO 4 STEP 1
8634 IF C(A)=0 THEN GOTO 8638
8636 IF C(A)=C(A+4) THEN GOTO 8668
8638 NEXT A
8644 FOR A=1 TO 4 STEP 1
8646 IF C(A)=1 THEN GOTO 8676
8648 NEXT A
8654 FOR A=5 TO 8 STEP 1
8656 IF C(A)=1 THEN GOTO 8686
8658 NEXT A
8662  P2=1
8664 GOTO 8800
8668  P2=0
8670 RETURN
8676  A=1
8678  S=5
8680 GOTO 8694
8686  A=5
8688  S=1
8694 IF C(A)=1 THEN GOTO 8728
8696 IF C(A+1)=1 THEN GOTO 8714
8698 IF C(A+2)=1 THEN GOTO 8742
8700 IF C(A+3)=1 THEN GOTO 8756
8706 GOTO 8662
8714  K=(Z(A)-X(A))/(X(S)-X(A)-Z(S)+Z(A))
8716  X(A)=K*(Z(S)-Z(A))+Z(A)
8718  Y(A)=K*(Y(S)-Y(A))+Y(A)
8720  Z(A)=X(A)
8722 GOTO 8600
8728  K=(Z(A)+X(A))/(X(A)-X(S)-Z(S)+Z(A))
8730  X(A)=K*(Z(A)-Z(S))-Z(A)
8732  Y(A)=K*(Y(S)-Y(A))+Y(A)
8734  Z(A)=-X(A)
8736 GOTO 8600
8742  K=(Z(A)+Y(A))/(Y(A)-Y(S)-Z(S)+Z(A))
8744  X(A)=K*(X(S)-X(A))+X(A)
8746  Y(A)=K*(Z(A)-Z(S))-Z(A)
8748  Z(A)=-Y(A)
8750 GOTO 8600
8756  K=(Z(A)-Y(A))/(Y(S)-Y(A)-Z(S)+Z(A))
8758  X(A)=K*(X(S)-X(A))+X(A)
8760  Y(A)=K*(Z(S)-Z(A))+Z(A)
8762  Z(A)=Y(A)
8764 GOTO 8600

8800 IF Z(1)=0 THEN Z(1)=.001
8845 IF Z(5)=0 THEN Z(5)=.001
8855  X(2)=X(1)/Z(1)*W
8860  Y(2)=Y(1)/Z(1)*W
8865  X(4)=X(5)/Z(5)*W
8870  Y(4)=Y(5)/Z(5)*W
8875 RETURN

9000 IF P2=0 THEN RETURN
9010  X(2)=X(2)+100
9012  Y(2)=100-Y(2)
9013  X(4)=X(4)+100
9014  Y(4)=100-Y(4)
9500 POKE 32792,19
9505 POKE 32792,17
9510 POKE 32793,89
9515 GOSUB 9550
9520 POKE 32793,X(2)
9522 GOSUB 9550
9525 POKE 32793,Y(2)
9527 GOSUB 9550
9529 POKE 32793,X(4)
9531 GOSUB 9550
9535 POKE 32793,Y(4)
9540 RETURN
9550  B9=PEEK (32792)
9555 IF B9=0 THEN GOTO 9550
9560 RETURN

9999 END
